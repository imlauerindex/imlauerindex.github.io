<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reversing: Exámen 11 (Ricardo Narvaja) | Index</title>
<meta name="robots" content='index, follow'>
<meta name="description" content="">
<meta name="generator" content="hugo-index">
<link crossorigin="anonymous" href="https://imlauerindex.github.io/assets/stylesheet.css" rel="preload stylesheet" as="style">
<script crossorigin="anonymous" src="https://imlauerindex.github.io/assets/quicklink.js" rel="preload" as="script"></script>
<script>
    window.addEventListener('load', () => {
        quicklink.listen();
    });
</script>

  </head>
  <body><header>
  <h1>
    <a href="https://imlauerindex.github.io/">
      <img src="https://imlauerindex.github.io/index.png" alt="Index">
      <span>Index</span>
    </a>
    <span class="hl">/</span>
    <a href="https://imlauerindex.github.io/ricardo_narvaja_11/">
      <span>Reversing: Exámen 11 (Ricardo Narvaja)</span>
    </a>
  </h1>
  <p class="desc"></p>
</header>
<div class="main">

<ul class="tagsList single">
  
  <li><a href="https://imlauerindex.github.io/@reversing/">Reversing</a></li>
  
  <li><a href="https://imlauerindex.github.io/@cracking/">Cracking</a></li>
  
  <li><a href="https://imlauerindex.github.io/@ricardo/">Ricardo</a></li>
  
  <li><a href="https://imlauerindex.github.io/@narvaja/">Narvaja</a></li>
  
  <li><a href="https://imlauerindex.github.io/@examen/">Examen</a></li>
  
  <li><a href="https://imlauerindex.github.io/@calculadora/">Calculadora</a></li>
  
</ul>

<div class="content"><p>Los retos los hice usando vim con la siguiente configuracion:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34; vim -b : edit binary using xxd-format!
</span></span><span class="line"><span class="cl">augroup Binary
</span></span><span class="line"><span class="cl">  au!
</span></span><span class="line"><span class="cl">  au BufReadPre  *.bin let &amp;bin=1
</span></span><span class="line"><span class="cl">  au BufReadPost *.bin if &amp;bin | %!xxd
</span></span><span class="line"><span class="cl">  au BufReadPost *.bin set ft=xxd | endif
</span></span><span class="line"><span class="cl">  au BufWritePre *.bin if &amp;bin | %!xxd -r
</span></span><span class="line"><span class="cl">  au BufWritePre *.bin endif
</span></span><span class="line"><span class="cl">  au BufWritePost *.bin if &amp;bin | %!xxd
</span></span><span class="line"><span class="cl">  au BufWritePost *.bin set nomod | endif
</span></span><span class="line"><span class="cl">augroup END
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">autocmd BufWritePost *.bin term ++close ++hidden cp % %:r.txt
</span></span></code></pre></div><h3 id="la-segunda-vez-me-generó-un-código-muchísimo-más-entendible">La segunda vez me generó un código muchísimo más entendible</h3>
<p>Porque renombre el tipo de variable que tomaba check en vez de <code>int</code> lo puse como <code>char **</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">check</span><span class="p">(</span><span class="kt">int</span> <span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+8h] [ebp-328h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="o">*</span><span class="n">v4</span><span class="p">[</span><span class="mi">201</span><span class="p">];</span> <span class="c1">// [esp+Ch] [ebp-324h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">800u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="mi">228u</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">54</span><span class="p">]</span> <span class="o">=</span> <span class="n">check</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">55</span><span class="p">]</span> <span class="o">=</span> <span class="n">system</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// strcpy copia hasta encontrar un caracter nulo (00 en hexa), acá no se produce overflow porque copias de un buffer de 200 a uno de 800
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">strcpy</span><span class="p">(</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// No queremos que pise el puntero a system con printf.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">55</span><span class="p">]</span> <span class="o">=</span> <span class="n">printf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Acá necesitamos copiar calc a v4[i]+200 (acá se produce el buffer overflow)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">strcpy</span><span class="p">(</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">200</span><span class="p">,</span> <span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Acá necesitamos llamar a system(calc)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">55</span><span class="p">](</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">A repasarrrr ... </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">FILE</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-3F8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [esp+8h] [ebp-3F4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+Ch] [ebp-3F0h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">v7</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span> <span class="c1">// [esp+10h] [ebp-3ECh] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">String</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span> <span class="c1">// [esp+330h] [ebp-CCh] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;C:</span><span class="se">\\</span><span class="s">lista.txt&#34;</span><span class="p">,</span> <span class="s">&#34;rb&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">String</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v4</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;No se puede leer la lista de alumnos bye bye </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fread</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="mi">200u</span><span class="p">,</span> <span class="mi">1u</span><span class="p">,</span> <span class="n">v4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nf">strtok</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v7</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;nombre = %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">v7</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Esto sirve para pasar a la siguiente palabra separada por un espacio.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">v7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">strtok</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#34; &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;nombre = %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">v7</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="o">++</span><span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;cantidad de alumnos %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">check</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="n">v7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Pero en la función check el decompilador no detectó el mensaje que decía &ldquo;Aprobaste nivel 11&rdquo;, este mensaje si fue detectado por el decompilador de ghidra (aunque se puede ver en el gráfico del assembler en ida si accedés a la función check)</p>
<h4 id="este-fue-el-código-generado-por-ghidra">Este fue el código generado por ghidra</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="kr">__cdecl</span> <span class="nf">check</span><span class="p">(</span><span class="kt">int</span> <span class="n">param_1</span><span class="p">,</span><span class="kt">int</span> <span class="n">param_2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">pcVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">iVar2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">local_32c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">local_328</span> <span class="p">[</span><span class="mi">200</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">uint</span> <span class="n">local_8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">local_8</span> <span class="o">=</span> <span class="n">DAT_10104004</span> <span class="o">^</span> <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="o">&amp;</span><span class="n">stack0xfffffffc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">iVar2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">local_328</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">800</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">local_32c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">local_32c</span> <span class="o">&lt;</span> <span class="n">param_1</span><span class="p">;</span> <span class="n">local_32c</span> <span class="o">=</span> <span class="n">local_32c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">pcVar1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nf">operator_new</span><span class="p">(</span><span class="mh">0xe4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">code</span> <span class="o">**</span><span class="p">)(</span><span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0xd8</span><span class="p">)</span> <span class="o">=</span> <span class="n">FUN_10101010</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">code</span> <span class="o">**</span><span class="p">)(</span><span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0xdc</span><span class="p">)</span> <span class="o">=</span> <span class="n">system_exref</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">strcpy</span><span class="p">(</span><span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">],</span><span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="p">)(</span><span class="n">param_2</span> <span class="o">+</span> <span class="n">local_32c</span> <span class="o">*</span> <span class="mi">4</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="p">(</span><span class="n">code</span> <span class="o">**</span><span class="p">)(</span><span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0xdc</span><span class="p">)</span> <span class="o">=</span> <span class="n">FUN_10101390</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">strcpy</span><span class="p">(</span><span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">]</span> <span class="o">+</span> <span class="mi">200</span><span class="p">,</span><span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="p">)(</span><span class="n">param_2</span> <span class="o">+</span> <span class="n">local_32c</span> <span class="o">*</span> <span class="mi">4</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">code</span> <span class="o">**</span><span class="p">)(</span><span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0xdc</span><span class="p">))(</span><span class="n">local_328</span><span class="p">[</span><span class="n">local_32c</span><span class="p">]</span> <span class="o">+</span> <span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">iVar2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">Aprobaste Nivel 11</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="n">iVar2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">A repasarrrr ... </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="n">iVar2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">__security_check_cookie</span><span class="err">@</span><span class="mi">4</span><span class="p">(</span><span class="n">local_8</span> <span class="o">^</span> <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="o">&amp;</span><span class="n">stack0xfffffffc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">FILE</span> <span class="o">*</span><span class="n">_File</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">pcVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">iVar2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">undefined</span> <span class="n">in_stack_fffffc00</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">code</span> <span class="o">*</span><span class="n">pcVar3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">local_3f8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">local_3f4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">local_3f0</span> <span class="p">[</span><span class="mi">200</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">local_d0</span> <span class="p">[</span><span class="mi">200</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">uint</span> <span class="n">local_8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">local_8</span> <span class="o">=</span> <span class="n">DAT_10104004</span> <span class="o">^</span> <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="o">&amp;</span><span class="n">stack0xfffffffc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">_File</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;C:</span><span class="se">\\</span><span class="s">lista.txt&#34;</span><span class="p">,</span><span class="s">&#34;rb&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">memset</span><span class="p">(</span><span class="n">local_d0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">_File</span> <span class="o">==</span> <span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;No se puede leer la lista de alumnos bye bye </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">in_stack_fffffc00</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="cm">/* WARNING: Subroutine does not return */</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fread</span><span class="p">(</span><span class="n">local_d0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">_File</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">local_3f0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nf">strtok</span><span class="p">(</span><span class="n">local_d0</span><span class="p">,</span><span class="s">&#34; &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">local_3f0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="cm">/* WARNING: Subroutine does not return */</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;nombre = %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="n">local_3f0</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="n">local_3f8</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">local_3f4</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">local_3f4</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="n">local_3f4</span> <span class="o">=</span> <span class="n">local_3f4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">pcVar1</span> <span class="o">=</span> <span class="nf">strtok</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="s">&#34; &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">local_3f0</span><span class="p">[</span><span class="n">local_3f4</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">local_3f0</span><span class="p">[</span><span class="n">local_3f4</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;nombre = %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="n">local_3f0</span><span class="p">[</span><span class="n">local_3f4</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">local_3f8</span> <span class="o">=</span> <span class="n">local_3f8</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">pcVar3</span> <span class="o">=</span> <span class="n">check</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;cantidad de alumnos %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="n">local_3f8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="o">*</span><span class="n">pcVar3</span><span class="p">)(</span><span class="n">local_3f8</span><span class="p">,</span><span class="n">local_3f0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">iVar2</span> <span class="o">=</span> <span class="err">@</span><span class="n">__security_check_cookie</span><span class="err">@</span><span class="mi">4</span><span class="p">(</span><span class="n">local_8</span> <span class="o">^</span> <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="o">&amp;</span><span class="n">stack0xfffffffc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">iVar2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="exploit-sin-ejecutar-la-calculadora">Exploit (sin ejecutar la calculadora)</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">00000000: 6361 6c63 2063 616c 6320 4141 4141 4141  calc calc AAAAAA
</span></span><span class="line"><span class="cl">00000010: 4141 4141 4141 4141 4141 4141 4141 5e11  AAAAAAAAAAAAAA^.
</span></span><span class="line"><span class="cl">00000020: 1010 0000 0000 0000 0000 0000 0000 0000  ................
</span></span></code></pre></div><p>Saltamos a la dirección <code>1010115e</code> que es en donde está el mensaje &ldquo;Aprobaste nivel 11&rdquo;</p>
<p>Para ejecutar la calculadora tenés que usar un &ldquo;gadget&rdquo; y buscar un <code>call ecx</code>
<code>Search &gt; gadgets &gt; search &gt; control +f &gt; call ecx</code> , hay un <code>call ecx</code> en <code>10102148</code></p>
<p>O podés usar <code>rp++</code> o <code>ropper</code> en linux para buscar los gadgets.</p>
</div></div><footer>
    <hr>
    <div class="footer-text">
        <div>© 2024 Index</div>
        <div>Powered by <a href="https://gohugo.io/">Hugo</a> & <a
                href="https://github.com/adityatelange/hugo-index/">Index</a></div>
    </div>
</footer>
</body>
</html>
